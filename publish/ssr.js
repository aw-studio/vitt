(()=>{"use strict";var e={n:r=>{var t=r&&r.__esModule?()=>r.default:()=>r;return e.d(t,{a:t}),t},d:(r,t)=>{for(var n in t)e.o(t,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:t[n]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)};const r=require("@babel/runtime/regenerator");var t=e.n(r);const n=require("express");var o=e.n(n);const a=require("puppeteer");var s=e.n(a);function u(e,r,t,n,o,a,s){try{var u=e[a](s),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}function c(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var a=e.apply(r,t);function s(e){u(a,n,o,s,c,"next",e)}function c(e){u(a,n,o,s,c,"throw",e)}s(void 0)}))}}var i=new Map;function l(e){return p.apply(this,arguments)}function p(){return(p=c(t().mark((function e(r){var n,o,a,u,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s().launch();case 2:return n=e.sent,e.next=5,n.newPage();case 5:if(o=e.sent,a=Date.now(),!i.has(r)){e.next=10;break}return console.log("from cache"),e.abrupt("return",{html:i.get(r),ttRenderMs:0});case 10:return e.prev=10,e.next=13,o.goto(r,{waitUntil:"networkidle0"});case 13:e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(10),console.error(e.t0),new Error("page.goto/waitForSelector timed out.");case 19:return e.next=21,o.content();case 21:return u=e.sent,e.next=24,n.close();case 24:return c=Date.now()-a,console.info("Headless rendered page in: ".concat(c,"ms")),i.set(r,u),e.abrupt("return",{html:u,ttRenderMs:c});case 28:case"end":return e.stop()}}),e,null,[[10,15]])})))).apply(this,arguments)}function v(e,r,t,n,o,a,s){try{var u=e[a](s),c=u.value}catch(e){return void t(e)}u.done?r(c):Promise.resolve(c).then(n,o)}var d=o()();d.post("/render",function(){var e,r=(e=t().mark((function e(r,n,o){var a,s,u;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(r.query.url);case 2:return a=e.sent,s=a.html,u=a.ttRenderMs,e.prev=5,n.set("Server-Timing","Prerender;dur=".concat(u,';desc="Headless render time (ms)"')),e.abrupt("return",n.status(200).send(s));case 10:e.prev=10,e.t0=e.catch(5),o(e.t0);case 13:case"end":return e.stop()}}),e,null,[[5,10]])})),function(){var r=this,t=arguments;return new Promise((function(n,o){var a=e.apply(r,t);function s(e){v(a,n,o,s,u,"next",e)}function u(e){v(a,n,o,s,u,"throw",e)}s(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}()),d.listen(8080,(function(){return console.log("Server started. Press Ctrl+C to quit")}))})();